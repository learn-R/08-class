pacman::p_load(sjmisc,
srvyr,
survey,
dplyr)
data <- readRDS("input/data/casen_proc.rds")
View(data)
pacman::p_load(tidyverse,
dplyr,
car,
haven,
sjmisc,
sjlabelled)
casen <- read_dta("input/data/Casen en Pandemia 2020 STATA.dta")
find_var(casen, 'strat')
find_var(casen, 'var')
data <- casen %>%
select(exp = expr, #Ponderador regional
varunit, #Conglomerado de varianza
varstrat, #Estrato de varianza
region, #Región
pobreza, #Situación de pobreza por ingresos
prev_salud = s13, #¿A qué sistema previsional de salud pertenece usted?
prev_pens = o31,#¿Se encuentra afiliado a algún sistema previsional?
ing_tot_hog = ytoth,#Ingreso total del hogar
tot_per) #Total de personas en el hogar
data <- data %>%
mutate_all(~as.numeric(.)) %>%
mutate(pobreza = car::recode(.$pobreza,
recodes = c("1 = 'Pobres extremos';
2 = 'Pobres no extremos';
3 = 'No pobres'"),
as.factor = T,
levels = c('Pobres extremos',
'Pobres no extremos',
'No pobres')),
prev_salud = car::recode(.$prev_salud,
recodes = c("1 = 'FONASA';
3 = 'ISAPRE';
c(2,4,5)= 'Otro';
9 = NA"),
as.factor = T, levels = c('FONASA', 'ISAPRE', 'Otro')),
prev_pens = car::recode(.$prev_pens,
recodes = c("1 = 'Sí';
2 = 'No';
9 = NA"),
as.factor = T, levels = c('Sí', 'No')),
region = car::recode(.$region,
recodes = c("1 = 'Tarapacá';
2 = 'Antofagasta';
3 = 'Atacama';
4 = 'Coquimbo';
5 = 'Valparaíso';
6 = 'OHiggins';
7 = 'Maule';
8 = 'Biobío';
9 = 'La Araucanía';
10 = 'Los Lagos';
11 = 'Aysén';
12 = 'Magallanes';
13 = 'Metropolitana';
14 = 'Los Ríos';
15 = 'Arica y Parinacota';
16 = 'Ñuble'"),
as.factor = T,
levels = c('Tarapacá',
'Antofagasta',
'Atacama',
'Coquimbo',
'Valparaíso',
'OHiggins',
'Maule',
'Biobío',
'La Araucanía',
'Los Lagos',
'Aysén',
'Magallanes',
'Metropolitana',
'Los Ríos',
'Arica y Parinacota',
'Ñuble'))) %>%
na.omit()
data$exp <- set_label(data$exp, 'Ponderador regional')
data$varunit <- set_label(data$varunit, 'Conglomerado de varianza')
data$varstrat <- set_label(data$varstrat, 'Estrato de varianza')
data$region <- set_label(data$region, 'Región')
data$pobreza <- set_label(data$pobreza, 'Situación de pobreza por ingresos')
data$prev_salud <- set_label(data$prev_salud, '¿A qué sistema previsional de salud pertenece usted?')
data$prev_pens <- set_label(data$prev_pens, '¿Se encuentra afiliado a algún sistema previsional?')
data$ing_tot_hog <- set_label(data$ing_tot_hog, 'Ingreso total del hogar')
data$tot_per <- set_label(data$tot_per, 'Total de personas en el hogar ')
saveRDS(data, "input/data/casen_proc.rds")
data <- readRDS("input/data/casen_proc.rds")
View(data)
get_label(data$varstrat)
casen_enc <- svydesign(
strata =  ~ varstrat,
id =  ~ varunit,
weights =  ~ expr,
data = data
)
casen <- read_dta("input/data/Casen en Pandemia 2020 STATA.dta")
data <- casen %>%
select(exp = expr, #Ponderador regional
varunit, #Conglomerado de varianza
varstrat, #Estrato de varianza
region, #Región
pobreza, #Situación de pobreza por ingresos
prev_salud = s13, #¿A qué sistema previsional de salud pertenece usted?
prev_pens = o31,#¿Se encuentra afiliado a algún sistema previsional?
ing_tot_hog = ytoth,#Ingreso total del hogar
tot_per) #Total de personas en el hogar
data <- data %>%
mutate_all(~as.numeric(.)) %>%
mutate(pobreza = car::recode(.$pobreza,
recodes = c("1 = 'Pobres extremos';
2 = 'Pobres no extremos';
3 = 'No pobres'"),
as.factor = T,
levels = c('Pobres extremos',
'Pobres no extremos',
'No pobres')),
prev_salud = car::recode(.$prev_salud,
recodes = c("1 = 'FONASA';
3 = 'ISAPRE';
c(2,4,5)= 'Otro';
9 = NA"),
as.factor = T, levels = c('FONASA', 'ISAPRE', 'Otro')),
prev_pens = car::recode(.$prev_pens,
recodes = c("1 = 'Sí';
2 = 'No';
9 = NA"),
as.factor = T, levels = c('Sí', 'No')),
region = car::recode(.$region,
recodes = c("1 = 'Tarapacá';
2 = 'Antofagasta';
3 = 'Atacama';
4 = 'Coquimbo';
5 = 'Valparaíso';
6 = 'OHiggins';
7 = 'Maule';
8 = 'Biobío';
9 = 'La Araucanía';
10 = 'Los Lagos';
11 = 'Aysén';
12 = 'Magallanes';
13 = 'Metropolitana';
14 = 'Los Ríos';
15 = 'Arica y Parinacota';
16 = 'Ñuble'"),
as.factor = T,
levels = c('Tarapacá',
'Antofagasta',
'Atacama',
'Coquimbo',
'Valparaíso',
'OHiggins',
'Maule',
'Biobío',
'La Araucanía',
'Los Lagos',
'Aysén',
'Magallanes',
'Metropolitana',
'Los Ríos',
'Arica y Parinacota',
'Ñuble'))) #%>%
data$exp <- set_label(data$exp, 'Ponderador regional')
data$varunit <- set_label(data$varunit, 'Conglomerado de varianza')
data$varstrat <- set_label(data$varstrat, 'Estrato de varianza')
data$region <- set_label(data$region, 'Región')
data$pobreza <- set_label(data$pobreza, 'Situación de pobreza por ingresos')
data$prev_salud <- set_label(data$prev_salud, '¿A qué sistema previsional de salud pertenece usted?')
data$prev_pens <- set_label(data$prev_pens, '¿Se encuentra afiliado a algún sistema previsional?')
data$ing_tot_hog <- set_label(data$ing_tot_hog, 'Ingreso total del hogar')
data$tot_per <- set_label(data$tot_per, 'Total de personas en el hogar ')
saveRDS(data, "input/data/casen_proc.rds")
data <- readRDS("input/data/casen_proc.rds")
casen_enc <- svydesign(
strata =  ~ varstrat,
id =  ~ varunit,
weights =  ~ expr,
data = data
)
?svydesign
casen_enc <- svydesign(
id =  ~ varunit,
strata =  ~ varstrat,
weights =  ~ expr,
data = data
)
casen_enc <- svydesign(
id =  ~ varunit,
strata =  ~ varstrat,
weights =  ~ expr,
data = data)
?as_survey_design
casen_enc <- svydesign(
ids =  ~ varunit,
strata =  ~ varstrat,
weights =  ~ expr,
data = data)
casen_enc <- as_survey_design(data,
ids = varunit,
strata = varstrat,
weights = expr)
casen_enc <- svydesign(
ids =  ~ varunit,
strata =  ~ varstrat,
weights =  ~ exp,
data = data)
View(casen_enc)
?survey
View(casen_enc)
data <- data %>%
mutate_all(~as.numeric(.)) %>%
mutate(pobreza = car::recode(.$pobreza,
recodes = c("1 = 'Pobres extremos';
2 = 'Pobres no extremos';
3 = 'No pobres'"),
as.factor = T,
levels = c('Pobres extremos',
'Pobres no extremos',
'No pobres')),
prev_salud = car::recode(.$prev_salud,
recodes = c("1 = 'FONASA';
3 = 'ISAPRE';
c(2,4,5)= 'Otro';
9 = NA"),
as.factor = T, levels = c('FONASA', 'ISAPRE', 'Otro')),
prev_pens = car::recode(.$prev_pens,
recodes = c("1 = 'Sí';
2 = 'No';
9 = NA"),
as.factor = T, levels = c('Sí', 'No')),
region = car::recode(.$region,
recodes = c("1 = 'Tarapacá';
2 = 'Antofagasta';
3 = 'Atacama';
4 = 'Coquimbo';
5 = 'Valparaíso';
6 = 'OHiggins';
7 = 'Maule';
8 = 'Biobío';
9 = 'La Araucanía';
10 = 'Los Lagos';
11 = 'Aysén';
12 = 'Magallanes';
13 = 'Metropolitana';
14 = 'Los Ríos';
15 = 'Arica y Parinacota';
16 = 'Ñuble'"),
as.factor = T,
levels = c('Tarapacá',
'Antofagasta',
'Atacama',
'Coquimbo',
'Valparaíso',
'OHiggins',
'Maule',
'Biobío',
'La Araucanía',
'Los Lagos',
'Aysén',
'Magallanes',
'Metropolitana',
'Los Ríos',
'Arica y Parinacota',
'Ñuble'))) %>%
na.omit()
data$exp <- set_label(data$exp, 'Ponderador regional')
data$varunit <- set_label(data$varunit, 'Conglomerado de varianza')
data$varstrat <- set_label(data$varstrat, 'Estrato de varianza')
data$region <- set_label(data$region, 'Región')
data$pobreza <- set_label(data$pobreza, 'Situación de pobreza por ingresos')
data$prev_salud <- set_label(data$prev_salud, '¿A qué sistema previsional de salud pertenece usted?')
data$prev_pens <- set_label(data$prev_pens, '¿Se encuentra afiliado a algún sistema previsional?')
data$ing_tot_hog <- set_label(data$ing_tot_hog, 'Ingreso total del hogar')
data$tot_per <- set_label(data$tot_per, 'Total de personas en el hogar ')
saveRDS(data, "input/data/casen_proc.rds")
data <- readRDS("input/data/casen_proc.rds")
casen_enc <- svydesign( #Creamos un nuevo objeto llamado casen_enc
ids =  ~ varunit, #Especificamos los conglomerados de varianza (id) como la variable varunit
strata =  ~ varstrat, #Especificamos los estratos de varianza (strata) como la variable varstrat
weights =  ~ exp, #Especificamos los ponderadores (weights) como la variable exp
data = data) #Especificamos que estamos trabajando con los datos de data
View(casen_enc)
svymean( ~ ing_tot_hog, casen_enc, na.rm = TRUE)
confint(svymean( ~ ing_tot_hog, casen_enc, na.rm = TRUE)) # Cálculo de intervalo de confianza
?confint
confint(svymean( ~ ing_tot_hog, casen_enc, na.rm = TRUE), level = 0.95) # Cálculo de intervalo de confianza
cv(svymean( ~ ing_tot_hog, casen_enc, na.rm = TRUE)) # Cálculo de coeficiente de variación
svyby( ~ ing_tot_hog, ~ pobreza, casen_enc, svymean, na.rm = TRUE)
casen_metrop <- subset(casen_enc, tot_per<=5 & region == 'Metropolitana')
svyby(  ~ ing_tot_hog, ~ prev_salud, casen_metrop, svymean, na.rm = TRUE)
svymean( ~ pobreza, casen_enc, na.rm = TRUE)
0.037970+0.057627+0.904403
svyboxplot(~ing_tot_hog~pobreza, casen_enc, all.outliers=TRUE)
svybarplot(~ing_tot_hog~pobreza, casen_enc, all.outliers=TRUE)
svyhist(~ing_tot_hog~pobreza, casen_enc, all.outliers=TRUE)
svyhist(~ing_tot_hog~pobreza, casen_enc, all.outliers=TRUE)
svyciprop( ~I(pobreza=="No pobre"), casen_enc)
?svyciprop
svyciprop( ~I(pobreza=="No pobre"), casen_enc)
svyciprop( ~I(prev_salud == "FONASA"), casen_enc)
svyciprop( ~I(prev_salud == "ISAPRE"), casen_enc)
svyciprop( ~I(prev_salud == "Otro"), casen_enc)
svyby (~pobreza, ~ prev_pens, casen_enc, na.rm = T, svymean)
barras <-svyby(~pobreza, ~prev_pens, casen_enc, na = TRUE, svymean)
barplot(barplot,beside=TRUE,legend=TRUE)
svyby (~ prev_pens, ~pobreza,  casen_enc, na.rm = T, svymean)
barras <-svyby(~prev_pens, ~pobreza, casen_enc, na = TRUE, svymean)
barplot(barplot,beside=TRUE,legend=TRUE)
barplot(barras,beside=TRUE,legend=TRUE)
svyhist(~ing_tot_hog, casen_enc)
svyhist(~tot_per, casen_enc)
